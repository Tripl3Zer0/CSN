<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Masterlist</title>
  <link rel="icon" href="../Drawables/CSNLogo.png');" type="image/png" />
  <link rel="stylesheet" href="Masterlist.css" />
</head>
<body>
  <!-- Top Banner -->
  <div class="top-banner">
    <div class="rectangle left" style="background-image: url('../Drawables/CSNBox.png');"></div>
    <div class="account-dropdown">
      <button class="account-btn">Account</button>
      <div class="account-content">
        <div class="user-info">
          <div class="circular-user-image" style="background-image: url('../Drawables/ProfilePic.png');"></div>
          <p class="user-name"><strong>Richard Villagen</strong></p>
        </div>
        <button class="manage-btn">Manage Account</button>
        <button class="logout-btn" onclick="window.location.href='../FacultyPortal/Faculty.html';">Log Out</button>
      </div>
    </div>
  </div>

  <!-- Birthday Notification -->
  <div id="birthdayNotification" style="display:none; background-color: #f0ad4e; color: white; padding: 10px; text-align: center;">
    ðŸŽ‰ It's <span id="birthdayStudentName"></span>'s birthday today! ðŸŽ‰
  </div>

  <div class="main-container">
    <!-- Top Section -->
    <div class="top-section">
      <!-- Search Bar and Filters -->
      <div class="search-filter">
        <input type="text" id="searchInput" placeholder="Search..." class="search-bar" onkeyup="filterTable()">
        <!-- Filter Dropdown -->
        <div class="filter-dropdown">
          <button class="dropdown-btn" onclick="toggleDropdown('filterDropdownContent')">Filter by</button>
          <div id="filterDropdownContent" class="dropdown-content">
            <!-- Birth Month Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('birthMonthDropdown')">Birth Month</button>
              <div id="birthMonthDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('month', 'April')">April</button>
                <button onclick="applyFilter('month', 'November')">November</button>
                <button onclick="applyFilter('month', 'July')">July</button>
              </div>
            </div>
            <!-- Age Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('ageDropdown')">Age</button>
              <div id="ageDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('age', '16')">16</button>
                <button onclick="applyFilter('age', '17')">17</button>
                <button onclick="applyFilter('age', '18')">18</button>
              </div>
            </div>
            <!-- Address Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('addressDropdown')">Address</button>
              <div id="addressDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('address', 'Moonwalk')">Moonwalk</button>
                <button onclick="applyFilter('address', 'Sto. NiÃ±o')">Sto. NiÃ±o</button>
                <button onclick="applyFilter('address', 'Tambo')">Tambo</button>
              </div>
            </div>
            <!-- Diagnosis Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('diagnosisDropdown')">Diagnosis</button>
              <div id="diagnosisDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('diagnosis', 'Autism Spectrum Disorder')">Autism Spectrum Disorder</button>
                <button onclick="applyFilter('diagnosis', 'Attention-deficit/hyperactivity disorder (ADHD)')">Attention-deficit/hyperactivity disorder (ADHD)</button>
                <button onclick="applyFilter('diagnosis', 'Intellectual Disability')">Intellectual Disability</button>
              </div>
            </div>
            <!-- Session Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('sessionDropdown')">Session</button>
              <div id="sessionDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('session', '3')">3</button>
                <button onclick="applyFilter('session', '4')">4</button>
                <button onclick="applyFilter('session', '5')">5</button>
              </div>
            </div>
          </div>
        </div>
        <!-- Remove Filter Button -->
        <button class="remove-filter-btn" onclick="resetFilters()">Remove Filter</button>
      </div>

      <!-- Undo Button and Add Button -->
      <div class="actions">
        <button id="undo-btn" class="undo-btn" style="display:none;" onclick="undoDelete()">Undo</button>
        <button class="add-btn" onclick="openForm()">Add Student</button>
      </div>
    </div>

    <!-- Table Section -->
    <table id="studentTable">
      <thead>
        <tr>
          <th>Student No.</th>
          <th>Name</th>
          <th>Birthday</th>
          <th>Age</th>
          <th>Address</th>
          <th>Contact</th>
          <th>Parent/Guardian</th>
          <th>Diagnosis</th>
          <th>Session</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>John Doe</td>
          <td>April 23, 2008</td>
          <td>16</td>
          <td>Moonwalk</td>
          <td>+63 9123456789</td>
          <td>Jane Doe</td>
          <td>Autism Spectrum Disorder</td>
          <td>5</td>
          <td>
            <button class="edit-btn" onclick="editStudent(this)">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
        <tr>
          <td>2</td>
          <td>Jane Smith</td>
          <td>November 03, 2007</td>
          <td>17</td>
          <td>Sto. NiÃ±o</td>
          <td>+63 9876543210</td>
          <td>John Smith</td>
          <td>Attention-deficit/hyperactivity disorder (ADHD)</td>
          <td>4</td>
          <td>
            <button class="edit-btn" onclick="editStudent(this)">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
        <tr>
          <td>3</td>
          <td>Michael Lee</td>
          <td>July 19, 2006</td>
          <td>18</td>
          <td>Tambo</td>
          <td>+63 9234567890</td>
          <td>Anna Lee</td>
          <td>Intellectual Disability</td>
          <td>3</td>
          <td>
            <button class="edit-btn" onclick="editStudent(this)">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
      <div class="modal-content animate">
        <span class="close" onclick="closeForm()">&times;</span>
        <h3 class="form-title">Add New Student</h3>
        <form id="studentForm">
          <div class="form-group">
            <label for="studentNo">Student No.</label>
            <input type="text" id="studentNo" placeholder="Enter student number" required>
          </div>

          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Enter student name" required>
          </div>

          <div class="form-group">
            <label for="birthday">Birthday</label>
            <input type="date" id="birthday" required oninput="calculateAge()">
          </div>

          <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" placeholder="Enter address" required>
          </div>

          <div class="form-group">
            <label for="contact">Contact</label>
            <input type="text" id="contact" placeholder="Enter contact number" required>
          </div>

          <div class="form-group">
            <label for="parentGuardian">Parent/Guardian</label>
            <input type="text" id="parentGuardian" placeholder="Enter parent/guardian" required>
          </div>

          <div class="form-group">
            <label for="diagnosis">Diagnosis</label>
            <select id="diagnosis" required>
              <option value="">Select Diagnosis</option>
              <option value="Autism Spectrum Disorder">Autism Spectrum Disorder</option>
              <option value="Attention-deficit/hyperactivity disorder (ADHD)">Attention-deficit/hyperactivity disorder (ADHD)</option>
              <option value="Intellectual Disability">Intellectual Disability</option>
            </select>
          </div>

          <div class="form-group">
            <label for="session">Session</label>
            <input type="number" id="session" required>
          </div>

          <button type="button" onclick="addStudent()">Add Student</button>
        </form>
      </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal">
      <div class="modal-content animate">
        <span class="close" onclick="closeEditForm()">&times;</span>
        <h3 class="form-title">Edit Student Information</h3>
        <form id="editStudentForm">
          <div class="form-group">
            <label for="editStudentNo">Student No.</label>
            <input type="text" id="editStudentNo" required>
          </div>

          <div class="form-group">
            <label for="editName">Name</label>
            <input type="text" id="editName" required>
          </div>

          <div class="form-group">
            <label for="editBirthday">Birthday</label>
            <input type="date" id="editBirthday" required>
          </div>

          <div class="form-group">
            <label for="editAddress">Address</label>
            <input type="text" id="editAddress" required>
          </div>

          <div class="form-group">
            <label for="editContact">Contact</label>
            <input type="text" id="editContact" required>
          </div>

          <div class="form-group">
            <label for="editParentGuardian">Parent/Guardian</label>
            <input type="text" id="editParentGuardian" required>
          </div>

          <div class="form-group">
            <label for="editDiagnosis">Diagnosis</label>
            <input type="text" id="editDiagnosis" required>
          </div>

          <div class="form-group">
            <label for="editSession">Session</label>
            <input type="number" id="editSession" required>
          </div>

          <button type="button" onclick="saveEditStudent()">Save Changes</button>
        </form>
      </div>
    </div>

    <script>
      let deletedRow = null;
      let deletedIndex = null;
      let currentEditRow = null;

      // Function to open the add student form
      function openForm() {
        document.getElementById("addStudentModal").style.display = "block";
      }

      // Function to close the add student form
      function closeForm() {
        document.getElementById("addStudentModal").style.display = "none";
      }

      // Function to open the edit student form
      function editStudent(button) {
        currentEditRow = button.parentNode.parentNode;
        const cells = currentEditRow.getElementsByTagName('td');

        document.getElementById("editStudentNo").value = cells[0].textContent;
        document.getElementById("editName").value = cells[1].textContent;
        document.getElementById("editBirthday").value = new Date(cells[2].textContent).toISOString().split('T')[0];
        document.getElementById("editAge").value = cells[3].textContent;
        document.getElementById("editAddress").value = cells[4].textContent;
        document.getElementById("editContact").value = cells[5].textContent;
        document.getElementById("editParentGuardian").value = cells[6].textContent;
        document.getElementById("editDiagnosis").value = cells[7].textContent;
        document.getElementById("editSession").value = cells[8].textContent;

        document.getElementById("editStudentModal").style.display = "block";
      }

      // Function to close the edit student form
      function closeEditForm() {
        document.getElementById("editStudentModal").style.display = "none";
      }

      // Function to save the edited student information
      function saveEditStudent() {
        const cells = currentEditRow.getElementsByTagName('td');
        
        cells[0].textContent = document.getElementById("editStudentNo").value;
        cells[1].textContent = document.getElementById("editName").value;
        cells[2].textContent = new Date(document.getElementById("editBirthday").value).toLocaleDateString();
        cells[3].textContent = document.getElementById("editAge").value;
        cells[4].textContent = document.getElementById("editAddress").value;
        cells[5].textContent = document.getElementById("editContact").value;
        cells[6].textContent = document.getElementById("editParentGuardian").value;
        cells[7].textContent = document.getElementById("editDiagnosis").value;
        cells[8].textContent = document.getElementById("editSession").value;

        closeEditForm();
      }

      // Function to add a new student to the table
      function addStudent() {
        const studentNo = document.getElementById("studentNo").value;
        const name = document.getElementById("name").value;
        const birthday = document.getElementById("birthday").value;
        const age = calculateAge(birthday);
        const address = document.getElementById("address").value;
        const contact = document.getElementById("contact").value;
        const parentGuardian = document.getElementById("parentGuardian").value;
        const diagnosis = document.getElementById("diagnosis").value;
        const session = document.getElementById("session").value;

        // Validate the input
        if (!studentNo || !name || !birthday || !address || !contact || !parentGuardian || !diagnosis || !session) {
          alert("Please fill in all fields.");
          return;
        }

        // Create a new row in the table
        const table = document.getElementById("studentTable").getElementsByTagName('tbody')[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
          <td>${studentNo}</td>
          <td>${name}</td>
          <td>${new Date(birthday).toLocaleDateString()}</td>
          <td>${age}</td>
          <td>${address}</td>
          <td>${contact}</td>
          <td>${parentGuardian}</td>
          <td>${diagnosis}</td>
          <td>${session}</td>
          <td>
            <button class="edit-btn" onclick="editStudent(this)">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        `;

        // Clear the form and close the modal
        document.getElementById("studentForm").reset();
        closeForm();
      }

      // Function to calculate age based on birthday
      function calculateAge(birthday) {
        const birthDate = new Date(birthday);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        return age;
      }

      // Function to display birthday notification if today is the student's birthday
      function checkBirthday() {
        const table = document.getElementById("studentTable").getElementsByTagName('tbody')[0];
        const rows = table.getElementsByTagName('tr');
        const today = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric' });

        for (let i = 0; i < rows.length; i++) {
          const cells = rows[i].getElementsByTagName('td');
          const birthday = cells[2].textContent;

          if (birthday === today) {
            document.getElementById("birthdayStudentName").textContent = cells[1].textContent;
            document.getElementById("birthdayNotification").style.display = "block";
            break;
          }
        }
      }

      // Call the birthday check when the page loads
      window.onload = checkBirthday;

      // Toggle the visibility of dropdown sections
      function toggleDropdown(id) {
        const dropdownContent = document.getElementById(id);
        dropdownContent.style.display = (dropdownContent.style.display === 'block') ? 'none' : 'block';
      }

      // Function to apply the filter and close the dropdown
      function applyFilter(filterType, filterValue) {
        filterTable(filterType, filterValue);
        closeDropdowns();
      }

      // Function to filter the table based on the selected criteria or search input
      function filterTable(filterType = null, filterValue = null) {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const table = document.getElementById('studentTable');
        const rows = table.getElementsByTagName('tr');
        
        for (let i = 1; i < rows.length; i++) {
          let row = rows[i];
          let shouldShow = false;

          // Search functionality: matches any field in the row
          if (searchInput) {
            let cells = row.getElementsByTagName('td');
            for (let j = 0; j < cells.length; j++) {
              if (cells[j].textContent.toLowerCase().includes(searchInput)) {
                shouldShow = true;
                break;
              }
            }
          }

          // Filter functionality
          if (filterType && filterValue) {
            if (filterType === 'month') {
              const birthMonth = row.cells[2].textContent.split(' ')[0]; // Get the birth month
              shouldShow = (birthMonth === filterValue);
            } else if (filterType === 'age') {
              const age = row.cells[3].textContent;
              shouldShow = (age === filterValue);
            } else if (filterType === 'address') {
              const address = row.cells[4].textContent;
              shouldShow = address.includes(filterValue);
            } else if (filterType === 'diagnosis') {
              const diagnosis = row.cells[7].textContent;
              shouldShow = (diagnosis === filterValue);
            } else if (filterType === 'session') {
              const session = row.cells[8].textContent;
              shouldShow = (session === filterValue);
            }
          }

          row.style.display = shouldShow ? '' : 'none';
        }
      }

      // Reset filters to show all rows
      function resetFilters() {
        const table = document.getElementById('studentTable');
        const rows = table.getElementsByTagName('tr');
        document.getElementById('searchInput').value = ''; // Clear search input
        for (let i = 1; i < rows.length; i++) {
          rows[i].style.display = ''; // Show all rows
        }
        closeDropdowns(); // Close the dropdown after resetting filters
      }

      // Delete row and show Undo button
      function confirmDelete(button) {
        const row = button.parentNode.parentNode;
        deletedRow = row.cloneNode(true); // Clone the row
        deletedIndex = row.rowIndex; // Save the row index
        row.classList.add('fade-out'); // Add fade-out animation

        // Wait for the animation to complete before removing the row
        setTimeout(() => {
          row.remove();
          document.getElementById('undo-btn').style.display = 'block'; // Show the undo button
        }, 500);
      }

      // Undo the deletion
      function undoDelete() {
        const table = document.getElementById('studentTable');
        table.insertRow(deletedIndex).innerHTML = deletedRow.innerHTML; // Re-insert the deleted row
        document.getElementById('undo-btn').style.display = 'none'; // Hide the undo button
        deletedRow = null;
        deletedIndex = null;
      }

      // Close all open dropdowns
      function closeDropdowns() {
        const dropdowns = document.getElementsByClassName('dropdown-content');
        for (let i = 0; i < dropdowns.length; i++) {
          dropdowns[i].style.display = 'none';
        }
      }

      // Close the modal if clicked outside
      window.onclick = function(event) {
        const addModal = document.getElementById("addStudentModal");
        const editModal = document.getElementById("editStudentModal");
        if (event.target == addModal) {
          addModal.style.display = "none";
        }
        if (event.target == editModal) {
          editModal.style.display = "none";
        }
      };
    </script>
  </div>
</body>
</html>
