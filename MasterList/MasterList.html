<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Masterlist</title>
  <link rel="icon" href="../Drawables/CSNLogo.png');" type="image/png" />
  <link rel="stylesheet" href="Masterlist.css" />
</head>
<body>
  <!-- Top Banner -->
  <div class="top-banner">
    <div class="rectangle left" style="background-image: url('../Drawables/CSNBox.png');"></div>
    <div class="account-dropdown">
      <button class="account-btn">Account</button>
      <div class="account-content">
        <div class="user-info">
          <div class="circular-user-image" style="background-image: url('../Drawables/ProfilePic.png');"></div>
          <p class="user-name"><strong>Richard Villagen</strong></p>
        </div>
        <button class="manage-btn">Manage Account</button>
        <button class="logout-btn" onclick="window.location.href='../FacultyPortal/Faculty.html';">Log Out</button>
      </div>
    </div>
  </div>

  <div class="main-container">
    <!-- Top Section -->
    <div class="top-section">
      <!-- Search Bar and Filters -->
      <div class="search-filter">
        <input type="text" id="searchInput" placeholder="Search..." class="search-bar" onkeyup="filterTable()">
        <!-- Filter Dropdown -->
        <div class="filter-dropdown">
          <button class="dropdown-btn" onclick="toggleDropdown('filterDropdownContent')">Filter by</button>
          <div id="filterDropdownContent" class="dropdown-content">
            <!-- Birth Month Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('birthMonthDropdown')">Birth Month</button>
              <div id="birthMonthDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('month', 'April')">April</button>
                <button onclick="applyFilter('month', 'November')">November</button>
                <button onclick="applyFilter('month', 'July')">July</button>
              </div>
            </div>
            <!-- Age Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('ageDropdown')">Age</button>
              <div id="ageDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('age', '16')">16</button>
                <button onclick="applyFilter('age', '17')">17</button>
                <button onclick="applyFilter('age', '18')">18</button>
              </div>
            </div>
            <!-- Address Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('addressDropdown')">Address</button>
              <div id="addressDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('address', 'Moonwalk')">Moonwalk</button>
                <button onclick="applyFilter('address', 'Sto. Niño')">Sto. Niño</button>
                <button onclick="applyFilter('address', 'Tambo')">Tambo</button>
              </div>
            </div>
            <!-- Diagnosis Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('diagnosisDropdown')">Diagnosis</button>
              <div id="diagnosisDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('diagnosis', 'Autism Spectrum Disorder')">Autism Spectrum Disorder</button>
                <button onclick="applyFilter('diagnosis', 'Attention-deficit/hyperactivity disorder (ADHD)')">Attention-deficit/hyperactivity disorder (ADHD)</button>
                <button onclick="applyFilter('diagnosis', 'Intellectual Disability')">Intellectual Disability</button>
              </div>
            </div>
            <!-- Session Filter -->
            <div class="dropdown-section">
              <button class="sub-dropdown-btn" onclick="toggleDropdown('sessionDropdown')">Session</button>
              <div id="sessionDropdown" class="sub-dropdown-content">
                <button onclick="applyFilter('session', '3')">3</button>
                <button onclick="applyFilter('session', '4')">4</button>
                <button onclick="applyFilter('session', '5')">5</button>
              </div>
            </div>
          </div>
        </div>
        <!-- Remove Filter Button -->
        <button class="remove-filter-btn" onclick="resetFilters()">Remove Filter</button>
      </div>

      <!-- Undo Button and Add Button -->
      <div class="actions">
        <button id="undo-btn" class="undo-btn" style="display:none;" onclick="undoDelete()">Undo</button>
        <button class="add-btn">Add Student</button>
      </div>
    </div>

    <!-- Table Section -->
    <table id="studentTable">
      <thead>
        <tr>
          <th>Student No.</th>
          <th>Name</th>
          <th>Birthday</th>
          <th>Age</th>
          <th>Address</th>
          <th>Contact</th>
          <th>Parent/Guardian</th>
          <th>Diagnosis</th>
          <th>Session</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>John Doe</td>
          <td>April 23, 2008</td>
          <td>16</td>
          <td>Moonwalk</td>
          <td>+63 9123456789</td>
          <td>Jane Doe</td>
          <td>Autism Spectrum Disorder</td>
          <td>5</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
        <tr>
          <td>2</td>
          <td>Jane Smith</td>
          <td>November 03, 2007</td>
          <td>17</td>
          <td>Sto. Niño</td>
          <td>+63 9876543210</td>
          <td>John Smith</td>
          <td>Attention-deficit/hyperactivity disorder (ADHD)</td>
          <td>4</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
        <tr>
          <td>3</td>
          <td>Michael Lee</td>
          <td>July 19, 2006</td>
          <td>18</td>
          <td>Tambo</td>
          <td>+63 9234567890</td>
          <td>Anna Lee</td>
          <td>Intellectual Disability</td>
          <td>3</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <script>
      let deletedRow = null;
      let deletedIndex = null;

      // Function to open the add student form
      function openForm() {
        document.getElementById("addStudentForm").style.display = "block";
      }

      // Function to close the add student form
      function closeForm() {
        document.getElementById("addStudentForm").style.display = "none";
      }

      // Function to add a new student to the table
      function addStudent() {
        const studentNo = document.getElementById("studentNo").value;
        const name = document.getElementById("name").value;
        const birthday = document.getElementById("birthday").value;
        const age = document.getElementById("age").value;
        const address = document.getElementById("address").value;
        const contact = document.getElementById("contact").value;
        const parentGuardian = document.getElementById("parentGuardian").value;
        const diagnosis = document.getElementById("diagnosis").value;
        const session = document.getElementById("session").value;

        // Validate the input
        if (!studentNo || !name || !birthday || !age || !address || !contact || !parentGuardian || !diagnosis || !session) {
          alert("Please fill in all fields.");
          return;
        }

        // Create a new row in the table
        const table = document.getElementById("studentTable").getElementsByTagName('tbody')[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
          <td>${studentNo}</td>
          <td>${name}</td>
          <td>${new Date(birthday).toLocaleDateString()}</td>
          <td>${age}</td>
          <td>${address}</td>
          <td>${contact}</td>
          <td>${parentGuardian}</td>
          <td>${diagnosis}</td>
          <td>${session}</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="confirmDelete(this)">Delete</button>
          </td>
        `;

        // Clear the form and close the modal
        document.getElementById("studentForm").reset();
        closeForm();
      }

      // Toggle the visibility of dropdown sections
      function toggleDropdown(id) {
        const dropdownContent = document.getElementById(id);
        dropdownContent.style.display = (dropdownContent.style.display === 'block') ? 'none' : 'block';
      }

      // Function to apply the filter and close the dropdown
      function applyFilter(filterType, filterValue) {
        filterTable(filterType, filterValue);
        closeDropdowns();
      }

      // Function to filter the table based on the selected criteria or search input
      function filterTable(filterType = null, filterValue = null) {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const table = document.getElementById('studentTable');
        const rows = table.getElementsByTagName('tr');
        
        for (let i = 1; i < rows.length; i++) {
          let row = rows[i];
          let shouldShow = false;

          // Search functionality: matches any field in the row
          if (searchInput) {
            let cells = row.getElementsByTagName('td');
            for (let j = 0; j < cells.length; j++) {
              if (cells[j].textContent.toLowerCase().includes(searchInput)) {
                shouldShow = true;
                break;
              }
            }
          }

          // Filter functionality
          if (filterType && filterValue) {
            if (filterType === 'month') {
              const birthMonth = row.cells[2].textContent.split(' ')[0]; // Get the birth month
              shouldShow = (birthMonth === filterValue);
            } else if (filterType === 'age') {
              const age = row.cells[3].textContent;
              shouldShow = (age === filterValue);
            } else if (filterType === 'address') {
              const address = row.cells[4].textContent;
              shouldShow = address.includes(filterValue);
            } else if (filterType === 'diagnosis') {
              const diagnosis = row.cells[7].textContent;
              shouldShow = (diagnosis === filterValue);
            } else if (filterType === 'session') {
              const session = row.cells[8].textContent;
              shouldShow = (session === filterValue);
            }
          }

          row.style.display = shouldShow ? '' : 'none';
        }
      }

      // Reset filters to show all rows
      function resetFilters() {
        const table = document.getElementById('studentTable');
        const rows = table.getElementsByTagName('tr');
        document.getElementById('searchInput').value = ''; // Clear search input
        for (let i = 1; i < rows.length; i++) {
          rows[i].style.display = ''; // Show all rows
        }
        closeDropdowns(); // Close the dropdown after resetting filters
      }

      // Delete row and show Undo button
      function confirmDelete(button) {
        const row = button.parentNode.parentNode;
        deletedRow = row.cloneNode(true); // Clone the row
        deletedIndex = row.rowIndex; // Save the row index
        row.classList.add('fade-out'); // Add fade-out animation

        // Wait for the animation to complete before removing the row
        setTimeout(() => {
          row.remove();
          document.getElementById('undo-btn').style.display = 'block'; // Show the undo button
        }, 500);
      }

      // Undo the deletion
      function undoDelete() {
        const table = document.getElementById('studentTable');
        table.insertRow(deletedIndex).innerHTML = deletedRow.innerHTML; // Re-insert the deleted row
        document.getElementById('undo-btn').style.display = 'none'; // Hide the undo button
        deletedRow = null;
        deletedIndex = null;
      }

      // Close all open dropdowns
      function closeDropdowns() {
        const dropdowns = document.getElementsByClassName('dropdown-content');
        for (let i = 0; i < dropdowns.length; i++) {
          dropdowns[i].style.display = 'none';
        }
      }

      // Close the dropdown when clicking outside of it
      window.onclick = function(event) {
        if (!event.target.matches('.dropdown-btn') && !event.target.matches('.sub-dropdown-btn')) {
          closeDropdowns();
        }
      }

      // Close the modal if clicked outside
      window.onclick = function(event) {
        const modal = document.getElementById("addStudentForm");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </div>
</body>
</html>